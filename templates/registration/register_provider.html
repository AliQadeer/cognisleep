{% extends "base_login_crop.html" %} {% load crispy_forms_tags %} {% load static %}
{% block content %}
<style>
  span#war_msg {
    color: red;
    float: left;
    width: 100%;
    font-weight: bold;
  }

  .patient_regist_form img {
    height: auto;
    object-fit: cover;
    margin: auto;
  }

  .take_btn button {
    font-size: 12px !important;
    white-space: nowrap;
  }

  .gap-15 {
    gap: 15px;
  }

  .provider_registeration form input {
    margin-bottom: 0;
  }

  video {
    display: none;
    width: 100%;
    height: auto !important;
  }

  .uploadedImage img {
    max-width: 100%;
  }



  .modal-backdrop.fade.in {
    opacity: 1;
  }

  .modal.fade.in {
    display: block !important;
    opacity: 1 !important;
    z-index: 9999999999 !important;
  }

  .modal-backdrop.fade.in:not(:last-child) {
    display: none;
  }

  .modal-backdrop.fade.in {
    z-index: 9999999;
  }

  .modal-content {
    width: 100% !important;
  }

  canvas {
    max-width: 100%;
  }

  img {
    max-width: 100%;
  }


  body {
    padding: 0 !important;
  }


  .take_btn {
    display: flex;
    gap: 15px;
  }



.take_btn .openCrop, .take_btn .croppedBtn {
    display: none;
}

{% comment %} .take_btn > button:not(:last-child) {
    width: 170px;
    justify-content: center;
} {% endcomment %}

.backBtn:hover {
    background-color: #79ce4a;
}

.videoBox button.clear, .videoBox button.turnCamera {
  display: none;
} 




@media(max-width: 799px) {
  .backBtn {
    position: absolute;
    left: 0;
  }
}
</style>
<section class="provider_login_sec">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="titleBoxArea text-center">
          <button onclick="history.back();" class="backBtn"><i class="fa fa-arrow-left"></i></button>
         <h3 class="defaultHead">Provider Registration</span></h3>
        </div>
      </div>
      {% if messages %} {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %} {% endif %}
      <div class="col-sm-12 col-md-12 col-lg-12">
        <div class="provider_registeration_form">
          <div class="provider_registeration patient_regist_form text-left">
            <h4>YOUR INFORMATION</h4>
              <p>Tip: If taking photo with your webcam, move the license back and forth until the text
                comes into focus. Then click to take photo and crop to the license size.</p>
            <form method="POST" action="" enctype="multipart/form-data" onsubmit="showLoader()">
              {% csrf_token %}
              <div class="form-group">

               <div class="row">
                  <div class="col-sm-12 col-md-6 col-lg-6">
                    <h5>Profile Picture</h5>
                    <div class="videoBox">
                      <!-- template.html -->
                      <!-- Add a button to trigger the image capture -->
                      <div class="d-flex flex-wrap flex-md-nowrap gap-15 align-items-center mb-3">
                        <div class="take_btn d-none">
                          <button class="showBox" id="capture-button-1" type="button">Start Camera</button>
                          <button class="clear" type="button" id="clear-btn-1"><i class="fa fa-undo"
                              aria-hidden="true"></i></button>
                          <button type="button" class="turnCamera" id="switch-camera-1"><i
                              class="fa fa-refresh"></i></button>
                          <button type="button" class="btn btn-primary openBox d-none" data-target=".modalOpen"
                            data-toggle="modal" id="crop-1">Open Crop</button>
                        </div>
                        <div class="input-group">
                          <span class="input-group-btn">
                            <input type="hidden" required value="" class="requiredFiled hidden_required_1">
                            <input type="file" id="provider_image" name="provider_image" accept="image/png, image/jpeg"
                              style="" />
                            <input type="hidden" required value="">
                          </span>
                        </div>
                      </div>
                      <!-- Add a video element to display the webcam video -->
                      <div class="take-photo">
                        <video class="showBox" id="capture-video-1" autoplay width="560" height="420"
                          playsinline></video>
                        <canvas class="showBox" id="capture-canvas-1" width="560" height="420"
                          style="display:none;"></canvas>
                        <div class="original_image">
                          <input type="hidden" id="hidden-image-1">
                        </div>
                        <div class="image_33">
                          <img class="imagecaptureBox" id="captured-image-1">
                        </div>
                        <input type="hidden" class="captureImageUrl crop_hidden_1" name="profile_image">
                      </div>
                      <!-- Add a div element to display the image file name -->
                    </div>
                    <div class="uploadedImage">
                      <img src="" class="uploadimageBox">
                    </div>

                  </div>
                  <div class="col-sm-12 col-md-6 col-lg-6">
                    <h5>Medical License</h5>
                    <div class="videoBox">
                      <!-- template.html -->
                      <!-- Add a button to trigger the image capture -->
                      <div class="d-flex flex-wrap flex-md-nowrap gap-15 align-items-center mb-3">
                        <div class="take_btn d-none">
                          <button class="showBox" id="capture-button-2" type="button">Start Camera</button>
                          <button class="clear" type="button" id="clear-btn-2"><i class="fa fa-undo"
                              aria-hidden="true"></i></button>
                          <button type="button" class="turnCamera" id="switch-camera-2"><i
                              class="fa fa-refresh"></i></button>
                          <button type="button" class="btn btn-primary openBox d-none" data-target=".modalOpen"
                            data-toggle="modal" id="crop-2">Open Crop</button>
                        </div>

                        <div class="input-group">
                          <span class="input-group-btn">
                            <input type="hidden" required value="" class="requiredFiled hidden_required_2">
                            <input type="file" id="medical_license_image" name="medical_license_image"
                              accept="image/png, image/jpeg" />
                          </span>
                        </div>
                      </div>

                      <div class="take-photo">
                        <video class="showBox" id="capture-video-2" autoplay width="560" height="420"
                          playsinline></video>
                        <canvas class="showBox" id="capture-canvas-2" width="560" height="420"
                          style="display:none;"></canvas>
                        <div class="original_image">
                          <input type="hidden" id="hidden-image-2">
                        </div>
                        <div class="image_33">
                          <img class="imagecaptureBox" id="captured-image-2">
                        </div>
                        <input type="hidden" class="captureImageUrl crop_hidden_2" name="medical_image">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-12 col-md-6 col-lg-6" style="margin-top: 20px;">
                    <div class="input-groups">
                      <span class="input-group-btn">

                        <h5>Drivers License Front</h5>
                        <div class="videoBox">
                          <!-- template.html -->
                          <!-- Add a button to trigger the image capture -->

                          <div class="d-flex flex-wrap flex-md-nowrap gap-15 align-items-center mb-3">
                            <div class="take_btn d-none">
                              <button class="showBox" id="capture-button-3" type="button">Start Camera</button>
                              <button class="clear" type="button" id="clear-btn-3"><i class="fa fa-undo"
                                  aria-hidden="true"></i></button>
                              <button type="button" class="turnCamera" id="switch-camera-3"><i
                                  class="fa fa-refresh"></i></button>
                              <button type="button" class="btn btn-primary openBox d-none" data-target=".modalOpen"
                                data-toggle="modal" id="crop-3">Open Crop</button>
                            </div>
                            <div class="input-group">
                              <span class="input-group-btn">
                                <input type="hidden" required value="" class="requiredFiled hidden_required_3">
                                <input type="file" name="driving_license_front_img" accept="image/png, image/jpeg"
                                  id="driving_license_front_img" />
                              </span>
                            </div>
                          </div>
                          <div class="take-photo">
                            <video class="showBox" id="capture-video-3" autoplay width="560" height="420"
                              playsinline></video>
                            <canvas class="showBox" id="capture-canvas-3" width="560" height="420"
                              style="display:none;"></canvas>
                            <div class="original_image">
                              <input type="hidden" id="hidden-image-3">
                            </div>
                            <div class="image_33">
                              <img class="imagecaptureBox" id="captured-image-3">
                            </div>
                            <input type="hidden" class="captureImageUrl crop_hidden_3" name="front_image">
                          </div>
                        </div>
                    </div>
                  </div>
                  <div class="col-sm-12 col-md-6 col-lg-6" style="margin-top: 20px;">
                    <h5>Drivers License Back</h5>
                    <div class="videoBox">
                      <!-- template.html -->
                      <!-- Add a button to trigger the image capture -->

                      <div class="d-flex flex-wrap flex-md-nowrap gap-15 align-items-center mb-3">
                        <div class="take_btn d-none">
                          <button class="showBox" id="capture-button-4" type="button">Start Camera</button>
                          <button class="clear" type="button" id="clear-btn-4"><i class="fa fa-undo"
                              aria-hidden="true"></i></button>
                          <button type="button" class="turnCamera" id="switch-camera-4"><i
                              class="fa fa-refresh"></i></button>
                          <button type="button" class="btn btn-primary openBox d-none" data-target=".modalOpen"
                            data-toggle="modal" id="crop-4">Open Crop</button>

                        </div>
                        <div class="input-group">
                          <span class="input-group-btn">
                            <input type="hidden" required value="" class="requiredFiled hidden_required_4">
                            <input type="file" name="driving_license_back_img" accept="image/png, image/jpeg"
                              id="driving_license_back_img" />
                          </span>
                        </div>
                      </div>
                      <div class="take-photo">
                        <video class="showBox" id="capture-video-4" autoplay width="560" height="420"
                          playsinline></video>
                        <canvas class="showBox" id="capture-canvas-4" width="560" height="420"
                          style="display:none;"></canvas>
                        <div class="original_image">
                          <input type="hidden" id="hidden-image-4">
                        </div>
                        <div class="image_33">
                          <img class="imagecaptureBox" id="captured-image-4">
                        </div>
                        <input type="hidden" class="captureImageUrl crop_hidden_4" name="back_image">
                        <!-- Add a div element to display the image file name -->
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row" style="    margin-top: 16px;">
                  <div class="col-sm-12 col-md-4 col-lg-4">
                    <h5>License State</h5>
                    <select id="license_state" name="license_state" class="form-control">
                      <option value="AL">Alabama</option>
                      <option value="AK">Alaska</option>
                      <option value="AZ">Arizona</option>
                      <option value="AR">Arkansas</option>
                      <option value="CA">California</option>
                      <option value="CO">Colorado</option>
                      <option value="CT">Connecticut</option>
                      <option value="DE">Delaware</option>
                      <option value="DC">District Of Columbia</option>
                      <option value="FL">Florida</option>
                      <option value="GA">Georgia</option>
                      <option value="HI">Hawaii</option>
                      <option value="ID">Idaho</option>
                      <option value="IL">Illinois</option>
                      <option value="IN">Indiana</option>
                      <option value="IA">Iowa</option>
                      <option value="KS">Kansas</option>
                      <option value="KY">Kentucky</option>
                      <option value="LA">Louisiana</option>
                      <option value="ME">Maine</option>
                      <option value="MD">Maryland</option>
                      <option value="MA">Massachusetts</option>
                      <option value="MI">Michigan</option>
                      <option value="MN">Minnesota</option>
                      <option value="MS">Mississippi</option>
                      <option value="MO">Missouri</option>
                      <option value="MT">Montana</option>
                      <option value="NE">Nebraska</option>
                      <option value="NV">Nevada</option>
                      <option value="NH">New Hampshire</option>
                      <option value="NJ">New Jersey</option>
                      <option value="NM">New Mexico</option>
                      <option value="NY">New York</option>
                      <option value="NC">North Carolina</option>
                      <option value="ND">North Dakota</option>
                      <option value="OH">Ohio</option>
                      <option value="OK">Oklahoma</option>
                      <option value="OR">Oregon</option>
                      <option value="PA">Pennsylvania</option>
                      <option value="RI">Rhode Island</option>
                      <option value="SC">South Carolina</option>
                      <option value="SD">South Dakota</option>
                      <option value="TN">Tennessee</option>
                      <option value="TX">Texas</option>
                      <option value="UT">Utah</option>
                      <option value="VT">Vermont</option>
                      <option value="VA">Virginia</option>
                      <option value="WA">Washington</option>
                      <option value="WV">West Virginia</option>
                      <option value="WI">Wisconsin</option>
                      <option value="WY">Wyoming</option>
                    </select>
                  </div>


                  <div class="col-sm-12 col-md-4 col-lg-4">
                    <h5>Type of Practice</h5>
                    <select id="type_of_practice" name="type_of_practice" class="form-control">
                      <option>Family Physician</option>
                      <option>Internal Medicine Physician</option>
                      <option>Pediatrician</option>
                      <option>Psychologist</option>
                      <option>Neurologist</option>
                      <option>Clinical Psychologist</option>
                      <option>Psychiatrist</option>
                      <option>Sleep Physician</option>
                      <option>Physician assistant</option>
                      <option>Nurse Practitioner</option>
                      <option>General Practitioner</option>
                      <option>Other</option>
                    </select>
                  </div>
                  <div class="col-sm-12 col-md-4 col-lg-4" id="addnewpractice">
                    <h5>Add New Practice Type</h5>
                    <input value='' type="text" placeholder="Enter New Practice Type" id="new_practice"
                      oninput="setCustomValidity('')" name="new_practice" pattern="[a-zA-Z][a-zA-Z ]+"
                      oninvalid="this.setCustomValidity('New Practice Type field should be alpha only')" />
                    <span id="war_msg"></span>
                  </div>
                </div>
                <div class="clearfix"></div>



                    <h4 class="provide_details px-0">PRACTICE LOCATION</h4>
                    <div class="row">
                      <div class="col-sm-12 col-md-3 col-lg-3">
                        <h5>Practice Name</h5>
                        <input class="form-control" value='{{ request.session.allform.practice_name|default_if_none:"" }}' type="text"
                          required=""  id="practice_name" oninput="setCustomValidity('')"
                          name="practice_name" pattern="[a-zA-Z][a-zA-Z ]+"
                          oninvalid="this.setCustomValidity('Practice name field should be alpha only')" />
                      </div>
                      <div class="col-sm-12 col-md-2 col-lg-2">
                        <h5>Practice Phone Number</h5>
                        <input class="form-control" value='{{ request.session.allform.practice_phone_number|default_if_none:"" }}' type="text"
                          required=""  id="practice_phone_number"
                          name="practice_phone_number" />
                      </div>
                      <div class="col-sm-12 col-md-2 col-lg-2">
                        <h5>Fax</h5>
                        <input class="form-control" value='{{ request.session.allform.fax_no|default_if_none:"" }}' type="text"
                           id="fax_no" name="fax_no" />
                        <input type="hidden" name="response_captcha" value="0" class="responseCaptcha" />
                      </div>
                      <div class="col-sm-12 col-md-5 col-lg-5">
                        <h5>Practice Address</h5>
                        <input class="form-control" value='{{ request.session.allform.practice_address|default_if_none:"" }}' type="text"
                           required="" id="practice_address" name="practice_address" />
                      </div>
  

                    </div>
                  </div>
                  <div class="row" style="padding-top: 15px;
    padding-left: 15px;">
                    <div class="col-sm-12 col-md-12 col-lg-12">
                      <div id="g-recaptcha2" class="g-recaptcha2"
                        data-sitekey="6Lf37LQUAAAAAIHIJDdoPYLF0pLXZ_zFwqbV2AAn"></div>
                    </div>
                  </div>
                  {% if error2 is not None %}
                  <br />
                  <b style="color: red;">{{error2}}</b>
                  {% endif %}
                  <input type="hidden" id="is_provider" name="is_provider" value="1" />
                  <div class="create_account_button">
                    <button class="login_buttonz validation_Check" href="#" type="button">Submit</button>
                    <button class="login_buttonz submitForm d-none" href="#" type="Submit">Submit</button>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="cropper">
            <div class="result"></div>
          </div>
          <!-- end -->
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Modal -->
<div class="modal fade modalOpen" data-backdrop="static" data-keyboard="false" tabindex="-1"
  aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header bg-secondary">
        <h5 class="modal-title" id="modalLabel">Cropper</h5>
        <button type="button" class="bg-transparent close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="img-container">
          <img id="image" src="" alt="Picture">
        </div>
      </div>
      <div class="modal-footer bg-secondary justify-content-center">
        <button type="button" class="btn btn-success" id="button" data-dismiss="modal">Crop</button>
      </div>
    </div>
  </div>
</div>

<div class="loaderBox d-none">
                    <div class="custom-loader"></div>
                </div>
{% endblock %} {% block jqueryScript %}
<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback2&render=explicit" async defer></script>

<!-- cropper functionality -->

<script>



  function closeWebCamera() {
    if (videoStream) {
      videoStream.getTracks().forEach(function (track) {
        track.stop();
      });
      console.log("Web camera closed successfully!");
    }
  }

  function captureImage(captureButtonId, captureVideoId, captureCanvasId, capturedImageId, imageNameInputId, switchButtonId, clearButtonId, hiddenImageId, cropBoxId) {
    // The JavaScript for the page
    const captureButton = document.getElementById(captureButtonId);
    const captureVideo = document.getElementById(captureVideoId);
    const captureCanvas = document.getElementById(captureCanvasId);
    const capturedImage = document.getElementById(capturedImageId);
    const imageNameDiv = document.getElementById(imageNameInputId);
    const switchButton = document.getElementById(switchButtonId);
    const clearButton = document.getElementById(clearButtonId);
    const hiddenImage = document.getElementById(hiddenImageId);
    const cropBox = document.getElementById(cropBoxId);
    let videoStream;
    // Set up the click event for the capture button
    clearButton.addEventListener('click', function () {
      captureVideo.srcObject = null;
      videoStream = null;

      // Call getUserMedia with the updated facingMode constraint
      navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } })
        .then(function (stream) {
          videoStream = stream;
          captureVideo.srcObject = stream;
        })
        .catch(function (error) {
          console.error('Error accessing the webcam:', error);
        });
    });


    // Set up the click event for the capture button
    captureButton.addEventListener('click', function () {
      // Start the video stream if it has not been started yet
      clearButton.style.display = 'none';
      switchButton.style.display = 'block';
      captureVideo.style.display = 'block';
      if (!videoStream) {
        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } })
          .then(function (stream) {
            videoStream = stream;
            captureVideo.srcObject = stream;
          })
          .catch(function (error) {
            console.error('Error accessing the webcam:', error);
          });
        clearButton.style.display = 'none';
        switchButton.style.display = 'block';
      }


      // Start the video
      captureVideo.play();

      // Draw the video frame to the canvas
      captureCanvas.getContext('2d').drawImage(captureVideo, 0, 0, captureCanvas.width, captureCanvas.height);
      capturedImage.src = captureCanvas.toDataURL('image/jpg');
      hiddenImage.value = capturedImage.src;
      localStorage.setItem('image', capturedImage.src);

      captureVideo.pause();
      videoStream.getTracks().forEach(function (track) {
        captureButton.style.display = 'none';
        clearButton.style.display = 'block';
        switchButton.style.display = 'none';
        captureVideo.style.display = 'none';
        cropBox.classList.remove('d-none');
        track.stop();
      });


      // Remove the click event for the capture button to prevent further captures
      captureButton.removeEventListener('click', this);
    });

    // Set up the click event for the switch camera button
    switchButton.addEventListener('click', function () {
      // Stop the current video stream
      videoStream.getTracks().forEach(function (track) {
        track.stop();
      });

      // Switch the camera by changing the video constraints
      const videoConstraints = captureVideo.srcObject.getVideoTracks()[0].getConstraints();
      console.log(videoConstraints);
      if (videoConstraints.facingMode === 'user') {
        videoConstraints.facingMode = 'environment';
      } else {
        videoConstraints.facingMode = 'user';
      }

      console.log(videoConstraints);

      // Restart the video stream with the new constraints
      navigator.mediaDevices.getUserMedia({ video: videoConstraints })
        .then(function (stream) {
          videoStream = stream;
          captureVideo.srcObject = stream;
        })
        .catch(function (error) {
          console.error('Error accessing the webcam:', error);
        });
    });

    clearButton.addEventListener('click', function () {
      clearButton.style.display = 'none';
      switchButton.style.display = 'block';
    });

  }


  // Set up the capture image function for the first instance
  captureImage('capture-button-1', 'capture-video-1', 'capture-canvas-1', 'captured-image-1', 'image-name-input-1', 'switch-camera-1', 'clear-btn-1', 'hidden-image-1', 'crop-1');
  captureImage('capture-button-2', 'capture-video-2', 'capture-canvas-2', 'captured-image-2', 'image-name-input-2', 'switch-camera-2', 'clear-btn-2', 'hidden-image-2', 'crop-2');
  captureImage('capture-button-3', 'capture-video-3', 'capture-canvas-3', 'captured-image-3', 'image-name-input-3', 'switch-camera-3', 'clear-btn-3', 'hidden-image-3', 'crop-3');
  captureImage('capture-button-4', 'capture-video-4', 'capture-canvas-4', 'captured-image-4', 'image-name-input-4', 'switch-camera-4', 'clear-btn-4', 'hidden-image-4', 'crop-4');


  // modal box crop


  window.addEventListener('DOMContentLoaded', function () {
    var image = document.getElementById('image');
    var cropper;
    var result = document.getElementById('result');
    var button = document.getElementById('button');

    $('.modalOpen').on('shown.bs.modal', function () {
      cropper = new Cropper(image, {
        autoCropArea: .5,
      });
    }).on('hidden.bs.modal', function () {
      cropper.destroy();
    });

    button.onclick = function () {
      const croppedCanvas = cropper.getCroppedCanvas();
      const imageUrl = croppedCanvas.toDataURL();
      jQuery('.activeCrop .imagecaptureBox').attr('src', imageUrl);
      jQuery('.activeCrop .captureImageUrl').val(imageUrl);
      jQuery('.modal-backdrop').remove();

    };
  });


  jQuery('.openBox').click(function () {
    jQuery('.videoBox').removeClass('activeCrop');
    jQuery(this).parents('.videoBox').addClass('activeCrop')
    let originalImage = jQuery(this).parents('.videoBox').find('.original_image input').val();
    jQuery('#image').attr('src', originalImage);

  })


<!--  jQuery('.provider_registeration form input').change(function (event) {-->

<!--    var files = jQuery(this)[0].files;-->
<!--    for (var i = 0; i < files.length; i++) {-->
<!--      var file = files[i];-->

<!--      // Check file type-->
<!--      if (!file.type.includes('image/')) {-->
<!--        alert('Please select only image files.');-->
<!--        jQuery(this).val('');-->
<!--      }-->
<!--      else {-->
<!--        var imageUrl = URL.createObjectURL(event.target.files[0]);-->
<!--        if (imageUrl != '') {-->
<!--          // closeWebCamera();-->
<!--          jQuery(this).parents('.videoBox').find('video').hide();-->
<!--          jQuery(this).parents('.videoBox').find('.turnCamera').hide();-->
<!--          jQuery(this).parents('.videoBox').find('.clear').show();-->
<!--          jQuery(this).parents('.videoBox').find('.openBox').removeClass('d-none');-->
<!--          jQuery(this).parents('.videoBox').find('.showBox').hide();-->
<!--          jQuery(this).parents('.videoBox').find('.imagecaptureBox').attr('src', URL.createObjectURL(event.target.files[0]));-->
<!--          jQuery(this).parents('.videoBox').find('.original_image input').val(URL.createObjectURL(event.target.files[0]));-->
<!--          jQuery(this).parents('.videoBox').find('.input-group-btn > input.requiredFiled').val(imageUrl);-->
<!--        }-->
<!--      }-->
<!--    }-->

<!--  })-->
jQuery('.provider_registeration form input').change(function (event) {
  var files = jQuery(this)[0].files;
  for (var i = 0; i < files.length; i++) {
    var file = files[i];

    // Check file type
    if (!file.type.includes('image/')) {
      alert('Please select only image files.');
      jQuery(this).val('');
    } else {
      var reader = new FileReader();
      reader.onload = function (e) {
        var dataURL = e.target.result;

        jQuery(this).parents('.videoBox').find('video').hide();
        jQuery(this).parents('.videoBox').find('.turnCamera').hide();
        jQuery(this).parents('.videoBox').find('.clear').show();
        jQuery(this).parents('.videoBox').find('.openBox').removeClass('d-none');
        jQuery(this).parents('.videoBox').find('.showBox').hide();
        // Perform actions with the data URL
        jQuery(this).parents('.videoBox').find('.imagecaptureBox').attr('src', dataURL);
        jQuery(this).parents('.videoBox').find('.captureImageUrl').val(dataURL);
        jQuery(this).parents('.videoBox').find('.original_image input').val(dataURL);
        jQuery(this).parents('.videoBox').find('.input-group-btn > input.requiredFiled').val(dataURL);
      }.bind(this);
      reader.readAsDataURL(file);
    }
  }
});

  jQuery('.clear').click(function () {
    jQuery(this).parents('.take_btn').find('.showBox').show();
    jQuery(this).parents('.videoBox').find('.openBox').addClass('d-none');
    jQuery(this).parents('.videoBox').find('video').show();
    jQuery(this).parents('.videoBox').find('input[type="file"]').val('');
    jQuery(this).parents('.videoBox').find('.imagecaptureBox').removeAttr('src');
  });

  jQuery('.showBox').click(function () {
    jQuery(this).text('Take Photo');
  });


  jQuery('.validation_Check').click(function () {
      jQuery('.captureImageUrl').each(function(){
        var getValue = jQuery(this).val();
        var storeValue = jQuery(this).parents('.videoBox').find('.imagecaptureBox').attr('src');
        if(getValue == '') {
            jQuery(this).val(storeValue);
            }
    });
      
    var required_1 = jQuery('.crop_hidden_1').val();
    var required_2 = jQuery('.crop_hidden_2').val();
    var required_3 = jQuery('.crop_hidden_3').val();
    var required_4 = jQuery('.crop_hidden_4').val();
    if (required_1 != '' && required_2 != '' && required_3 != '' && required_4 != '') {
      jQuery('.submitForm').trigger('click');
    } else {
      alert('Upload Fields are required.')
    }
  });


  jQuery('.close').click(function () {
    jQuery('.modal-backdrop').remove();
  })


  $(document).ready(function () {
    webcam_check_func();
  });

  function webcam_check_func() {
    var hasWebcam = false;
    var device = [];
    if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {

      navigator.enumerateDevices = function (callback) {
        navigator.mediaDevices.enumerateDevices().then(callback);
      };
      navigator.enumerateDevices(function (devices) {
        devices.forEach(function (my_device) {

          if (my_device.kind === 'videoinput') {
            // debugger;
            hasWebcam = true;
          }
        }
        );
        //alert("Has Web Camera -->" + hasWebcam);
        jQuery('.take_btn').removeClass('d-none');
      });
    }

  }

</script>


<!-- end  -->


<script>
  var recaptchaValid2 = 0
  $('#g-recaptcha-response-1').attr('required', true)

  var onloadCallback2 = function () {
    grecaptcha.render('g-recaptcha2', {
      sitekey: $('#g-recaptcha2').data('sitekey'),
      callback: correctCaptcha2,
    })
  }

  var correctCaptcha2 = function (response) {
    //alert($('#g-recaptcha').length);
    var response2 = grecaptcha.getResponse()
    if (response.length == 0) {
      recaptchaValid2 = 0

    } else {
       recaptchaValid2 = 1
       $(".create_account_button").show();
     }
<!--     setTimeout(function () {-->
<!--       recaptchaValid2 = 0-->
<!--       $('.responseCaptcha').val(recaptchaValid2)-->
<!--       grecaptcha.reset()-->
<!--     }, 15000)-->

     $('.responseCaptcha').val(recaptchaValid2)
   }



  document
    .getElementById('practice_phone_number')
    .addEventListener('input', function (e) {
      var x = e.target.value
        .replace(/\D/g, '')
        .match(/(\d{0,3})(\d{0,3})(\d{0,4})/)
      e.target.value = !x[2]
        ? x[1]
        : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '')
    });

  document.getElementById('fax_no').addEventListener('input', function (e) {
    var x = e.target.value
      .replace(/\D/g, '')
      .match(/(\d{0,3})(\d{0,3})(\d{0,4})/)
    e.target.value = !x[2]
      ? x[1]
      : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '')
  });
  $(document).ready(function () {
    $(document).on('change', '.btn-file :file', function () {
      var input = $(this),
        label = input.val().replace(/\\/g, '/').replace(/.*\//, '')
      input.trigger('fileselect', [label])
    })

    $('.btn-file :file').on('fileselect', function (event, label) {
      var input = $(this).parents('.input-group').find(':text'),
        log = label

      if (input.length) {
        input.val(log)
      } else {
        //if( log ) alert(log);
      }
    })

    function readURL(input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader()

        reader.onload = function (e) {
          $('#img-upload').attr('src', e.target.result)
        }

        reader.readAsDataURL(input.files[0])
      }
    }


    $('#provider_image').change(function () {
      readURL(this)
    })
  })
</script>
<script type="text/javascript">
 


  $("#addnewpractice").hide();
  $(".create_account_button").hide();
  $("#war_msg").hide();
  $('#email_message').hide();

  $("#type_of_practice").change(function () {

    if ($("#type_of_practice").val() == 'Other') {

      $("#addnewpractice").show();
      $("#new_practice").focus();

    }
    else {
      $("#addnewpractice").hide();
    }

  });
  $("#new_practice").blur(function () {

    if ($("#new_practice").val() == '') {
      $("#new_practice").focus();
      $("#war_msg").text('Please Enter a Pratice Type Here.');
      $("#war_msg").show();
      $("#new_practice").css('border', '1px solid red');

    }
    else {
      $("#new_practice").css('border', '1px solid #e2e2e2');
      $("#war_msg").hide();
      $('#provider_image').focus();
    }

  });

  $('#id_password1').focusout(function () {
    var pass = $('#id_password1').val()
    var confirm_pass = $('#id_password2').val()

    if (pass != confirm_pass) {
      var p = "Password did'nt Match"
      $('#password_error').html(p)
      $('#password_error').css('color', 'red')
    }
    var password_regex = /^(?=.*\d)(?=.*[~!@#$%^*()_\-+=|\\{}[\]:;<>?/])(?=.*[A-Za-z])(?=.*[a-z])\S{8,200}$/

    if (pass.length < 8) {
      // if invalid email
      // your condition here
      var passmatch =
        // "*Password should be minimum 8 characters <br>*Include at least a number and symbol<br>*Don't Use (&) Sign"
        "*Password should be minimum 8 characters"
      $('#password_error').html(passmatch)
      $('#password_error').css('color', 'red')
      $('#message_hide').css('display', 'none')
    } else {
      var passvld = 'Strong Password'
      $('#password_error').html(passvld)
      $('#password_error').css('color', 'green')
      $('#message_hide').css('display', 'none')
    }
    if (pass != '' && confirm_pass != '') {
      if (pass == confirm_pass) {
        //working
        $('#id_password1').css('border', '1px solid green')
        $('#id_password2').css('border', '1px solid green')
        var error_message = '<br> *Password Match'
        $('#password_error2').html(error_message)
        $('#password_error2').css('color', 'green')
      } else {
        var error_message = "<br> *Password did'nt Match"
        $('#password_error2').html(error_message)
        $('#password_error2').css('color', 'red')
        $('#id_password1').css('border', '1px solid red')
        $('#id_password2').css('border', '1px solid red')
      }
    }
  })
  //matching
  $('#id_password2').focusout(function () {
    var pass = $('#id_password1').val()
    var confirm_pass = $('#id_password2').val()

    if (pass != '' && confirm_pass != '') {
      if (pass == confirm_pass) {
        $('#id_password1').css('border', '1px solid green')
        $('#id_password2').css('border', '1px solid green')
        var error_message = '<br> *Password Match'
        $('#password_error2').html(error_message)
        $('#password_error2').css('color', 'green')
        $('#password_error3').css('display', 'none')
      } else {
        var error_message = "<br> *Password did'nt Match"
        $('#password_error2').html(error_message)
        $('#password_error2').css('color', 'red')
        $('#id_password1').css('border', '1px solid red')
        $('#id_password2').css('border', '1px solid red')
      }
    } else {
      var error_message = '<br> *Password Fields are empty'
      $('#password_error3').html(error_message)
      $('#password_error3').css('color', 'red')
      $('#id_password1').css('border', '1px solid red')
      $('#id_password2').css('border', '1px solid red')
    }
  });
  /*$(document).ready(function() {
    $('#id_email').blur(function() {
      var useremail = $(this).val();

      $.ajax({
        url: '/accounts/validate_email/',
        data: {
          'id_email': useremail
        },
        dataType: 'json',
        success: function (data) {
          if (data.is_taken) {
            //alert("This email address already in use");

            $('#id_email').focus();
            $('#email_message').attr('hidden', false);
            $('#email_message').show();
            $("#id_email").css('border', '1px solid red');
          }
          else {
            $("#id_email").css('border', '1px solid #dedede');
            $('#email_message').hide();
          }
        }
      });
    });
  });*/
  $(document).ready(function () {
    $('#id_email').blur(function () {
      var useremail = $(this).val();
      var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
      if (!regex.test(useremail)) {
        $('#id_email').focus();
        //$('#email_message_f').attr('hidden', false);
        $('#email_message').text("Invalid Email Format");
        $('#email_message').show();
        $("#id_email").css('border', '1px solid red');
        console.log("False");

      }
      else {
        //$("#id_email").css('border', '1px solid #dedede');
        //$('#email_message').hide();
        $.ajax({
          url: '/accounts/validate_email/',
          data: {
            'id_email': useremail
          },
          dataType: 'json',
          success: function (data) {
            if (data.is_taken) {
              //alert("This email address already in use");

              $('#id_email').focus();
              //$('#email_message').attr('hidden', false);
              $('#email_message').text("This email is already in use");
              $('#email_message').show();
              $("#id_email").css('border', '1px solid red');
            }
            else {
              $("#id_email").css('border', '1px solid #dedede');
              $('#email_message').hide();
            }
          }
        });
      }
    });

  });


  function showLoader() {
  // Show the loader
  document.querySelector(".loaderBox").classList.remove("d-none");

  // Simulate a delay (you can replace this with actual form submission)
  // setTimeout(function() {
  //   // Hide the loader after the delay (replace this with your form submission success logic)
  //   document.querySelector(".loaderBox").classList.add("d-none");

  // }, 2000);
}

</script>


{% endblock %}